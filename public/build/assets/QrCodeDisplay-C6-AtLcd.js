import{r as f,j as e}from"./app-CEfohHKB.js";import{B as i}from"./button-Cf5OBkvA.js";import{D as _,a as M,b as $,c as E,d as q,e as z}from"./dialog-C4-5XeL2.js";import{t as r}from"./index-BC4llrPh.js";import{c as w}from"./createLucideIcon-C1kX6QOl.js";import{C as S,E as T}from"./square-pen-C_JLgWe0.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],B=w("Download",P);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],j=w("QrCode",F);function J({attendant:c,size:m="md"}){const[s,v]=f.useState(""),[h,g]=f.useState(!1),x=`/profile/${c.qr_token}`,p=`${window.location.origin}${x}`,C=async()=>{if(!s){g(!0);try{const o=await(await fetch(`/attendants/${c.id}/qr-code`)).text();v(o)}catch(t){r.error("Failed to generate QR code"),console.error("QR code generation error:",t)}finally{g(!1)}}},k=async()=>{try{await navigator.clipboard.writeText(p),r.success("Profile URL copied to clipboard!")}catch{const o=document.createElement("textarea");o.value=p,document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy"),r.success("Profile URL copied to clipboard!")}catch{r.error("Failed to copy URL")}document.body.removeChild(o)}},b=async t=>{if(!s){r.error("QR code not generated yet");return}try{const o=document.createElement("canvas"),l=2,u=400*l;o.width=u,o.height=u;const a=o.getContext("2d");if(!a)throw new Error("Could not get canvas context");a.scale(l,l);const d=new Image;d.onload=function(){a.fillStyle="#ffffff",a.fillRect(0,0,400,400),a.drawImage(d,0,0,400,400);const U=t==="jpg"?"image/jpeg":"image/png",D=t==="jpg"?.95:1,L=o.toDataURL(U,D),n=document.createElement("a");n.href=L,n.download=`${c.full_name.replace(/\s+/g,"_")}_QR_Code.${t}`,document.body.appendChild(n),n.click(),document.body.removeChild(n),r.success(`QR code downloaded as ${t.toUpperCase()}`)},d.onerror=function(){r.error("Failed to process QR code")};const N=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),y=URL.createObjectURL(N);d.src=y,setTimeout(()=>URL.revokeObjectURL(y),1e3)}catch(o){r.error("Failed to download QR code"),console.error("Download error:",o)}},R=m==="sm"?"sm":m==="lg"?"lg":"default",Q=m==="sm"?"h-3 w-3":"h-4 w-4";return e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(i,{variant:"outline",size:R,onClick:C,disabled:h,children:[e.jsx(j,{className:`${Q} mr-2`}),h?"Generating...":"QR Code"]})}),e.jsxs($,{className:"max-w-md",children:[e.jsxs(E,{children:[e.jsxs(q,{children:["QR Code - ",c.full_name]}),e.jsx(z,{children:"Scan this QR code to view the attendant's profile"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Profile URL:"}),e.jsx("p",{className:"text-sm break-all",children:p})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[s?e.jsx("div",{className:"p-4 bg-white rounded-lg border shadow-sm",dangerouslySetInnerHTML:{__html:s}}):e.jsx("div",{className:"flex items-center justify-center h-64 w-full border-2 border-dashed border-muted-foreground/25 rounded-lg",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(j,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),h?e.jsx("p",{children:"Generating QR code..."}):e.jsx("p",{children:'Click "QR Code" to generate'})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 w-full",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>b("jpg"),disabled:!s,children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Download"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:k,children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Copy URL"]}),e.jsx(i,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:x,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"View"]})})]})]})]})]})]})}export{B as D,J as Q};
